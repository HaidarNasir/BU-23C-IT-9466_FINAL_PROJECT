<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIMS - User Dashboard</title>
    <link rel="stylesheet" href="user-dashboard.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">🔒 PIMS - POLICE INFORMATION MANAGEMENT SYSTEM</div>
        <div class="navbar-user">
            <span id="userInfo">Welcome, User</span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </nav>

    <div class="sidebar">
        <ul class="sidebar-menu">
            <li class="active" onclick="showSection('dashboard')">📊 Dashboard Overview</li>
            <li onclick="showSection('complaints')">📋 Complaint Management</li>
            <li onclick="showSection('suspects')">👤 Suspect Management</li>
            <li onclick="showSection('detentions')">⛓️ Detention Management</li>
            <li onclick="showSection('reports')">📈 Reports & Analytics</li>
        </ul>
    </div>

    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <h2 class="section-title">🛡️ System Overview</h2>

            <div class="stats-grid">
                <div class="stat-card user-card">
                    <div class="stat-number" id="totalComplaints">0</div>
                    <div class="stat-label">Total Complaints</div>
                </div>
                <div class="stat-card user-card">
                    <div class="stat-number" id="underInvestigation">0</div>
                    <div class="stat-label">Under Investigation</div>
                </div>
                <div class="stat-card user-card">
                    <div class="stat-number" id="chargedCases">0</div>
                    <div class="stat-label">Charged Cases</div>
                </div>
                <div class="stat-card user-card">
                    <div class="stat-number" id="closedCases">0</div>
                    <div class="stat-label">Closed Cases</div>
                </div>
            </div>

            <div class="user-panels">
                <div class="user-panel">
                    <h3>📈 Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="showSection('complaints')">➕ New Complaint</button>
                        <button class="btn btn-success" onclick="showSection('suspects')">👤 Add Suspect</button>
                        <button class="btn btn-warning" onclick="showSection('detentions')">⛓️ Record Detention</button>
                    </div>
                </div>

                <div class="user-panel">
                    <h3>🚨 Recent Activity</h3>
                    <div id="recentActivity">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Complaints Section -->
        <div id="complaints" class="content-section">
            <h2 class="section-title">📋 Complaint Management</h2>

            <div class="user-actions">
                <button class="btn btn-primary" onclick="showComplaintForm()">➕ Add New Complaint</button>
                <button class="btn btn-warning" onclick="loadComplaints()">🔄 Refresh</button>
            </div>

            <div id="complaintForm" style="display: none; margin: 2rem 0; padding: 1.5rem; background: #f8f9fa; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h3>📝 New Complaint Form</h3>
                <form id="newComplaintForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Complainant Name *</label>
                            <input type="text" name="complainantName" required>
                        </div>
                        <div class="form-group">
                            <label>Contact Information</label>
                            <input type="text" name="complainantContact">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Crime Type *</label>
                            <select name="crimeType" required>
                                <option value="">Select Crime Type</option>
                                <option value="Theft">Theft</option>
                                <option value="Assault">Assault</option>
                                <option value="Burglary">Burglary</option>
                                <option value="Robbery">Robbery</option>
                                <option value="Fraud">Fraud</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Priority *</label>
                            <select name="priority" required>
                                <option value="Low">Low</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Crime Location *</label>
                        <input type="text" name="crimeLocation" required>
                    </div>
                    <div class="form-group">
                        <label>Description *</label>
                        <textarea name="description" rows="4" required placeholder="Provide detailed description of the complaint..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">✅ Create Complaint</button>
                        <button type="button" class="btn btn-warning" onclick="hideComplaintForm()">❌ Cancel</button>
                    </div>
                </form>
            </div>

            <table id="complaintsTable">
                <thead>
                    <tr>
                        <th>Case Number</th>
                        <th>Complainant</th>
                        <th>Crime Type</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Priority</th>
                        <th>Date Reported</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Complaints will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Suspects Section -->
        <div id="suspects" class="content-section">
            <h2 class="section-title">👤 Suspect Management</h2>

            <div class="user-actions">
                <button class="btn btn-primary" onclick="showSuspectForm()">➕ Add New Suspect</button>
                <button class="btn btn-warning" onclick="loadSuspects()">🔄 Refresh</button>
            </div>

            <div id="suspectForm" style="display: none; margin: 2rem 0; padding: 1.5rem; background: #f8f9fa; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h3>📝 New Suspect Form</h3>
                <form id="newSuspectForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Gender *</label>
                            <select name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" name="dateOfBirth">
                        </div>
                        <div class="form-group">
                            <label>Identification Number</label>
                            <input type="text" name="identificationNumber">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <textarea name="address" rows="3" placeholder="Enter suspect's address..."></textarea>
                    </div>
                    <!-- NEW: Complaint Selection -->
                    <div class="form-group">
                        <label>Related Complaint (Optional)</label>
                        <select name="complaintId" id="complaintSelect">
                            <option value="">Select Complaint (Optional)</option>
                            <!-- Complaints will be loaded here dynamically -->
                        </select>
                        <small style="color: #666;">Link this suspect to a specific complaint case</small>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">✅ Add Suspect</button>
                        <button type="button" class="btn btn-warning" onclick="hideSuspectForm()">❌ Cancel</button>
                    </div>
                </form>
            </div>

            <table id="suspectsTable">
                <thead>
                    <tr>
                        <th>Suspect ID</th>
                        <th>Name</th>
                        <th>Gender</th>
                        <th>Related Complaint</th>
                        <th>Crime Type</th>
                        <th>Identification</th>
                        <th>Date Added</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Suspects will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Detentions Section -->
        <div id="detentions" class="content-section">
            <h2 class="section-title">⛓️ Detention Management</h2>

            <div class="user-actions">
                <button class="btn btn-primary" onclick="showDetentionForm()">⛓️ Record New Detention</button>
                <button class="btn btn-warning" onclick="loadDetentions()">🔄 Refresh</button>
            </div>

            <div id="detentionForm" style="display: none; margin: 2rem 0; padding: 1.5rem; background: #f8f9fa; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h3>📝 New Detention Record</h3>
                <form id="newDetentionForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Suspect *</label>
                            <select name="suspectId" id="suspectSelect" required>
                                <option value="">Select Suspect</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Intake Time *</label>
                            <input type="datetime-local" name="intakeTime" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Reason for Detention *</label>
                        <textarea name="reason" rows="3" required placeholder="Provide detailed reason for detention..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">✅ Record Detention</button>
                        <button type="button" class="btn btn-warning" onclick="hideDetentionForm()">❌ Cancel</button>
                    </div>
                </form>
            </div>

            <table id="detentionsTable">
                <thead>
                    <tr>
                        <th>Suspect Name & ID</th>
                        <th>Related Complaint</th>
                        <th>Intake Time</th>
                        <th>Release Time</th>
                        <th>Duration</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Detentions will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="content-section">
            <h2 class="section-title">📈 Reports & Analytics</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="reportTotalComplaints">0</div>
                    <div class="stat-label">Total Complaints</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="reportUnderInvestigation">0</div>
                    <div class="stat-label">Under Investigation</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="reportChargedCases">0</div>
                    <div class="stat-label">Charged Cases</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="reportClosedCases">0</div>
                    <div class="stat-label">Closed Cases</div>
                </div>
            </div>

            <div class="user-panels">
                <div class="user-panel">
                    <h3>📊 Crime Statistics</h3>
                    <div style="padding: 1rem; text-align: center; background: white; border-radius: 10px; margin-top: 1rem;">
                        <canvas id="crimeChart" width="400" height="200"></canvas>
                        <p style="color: #666; margin-top: 1rem;">Crime distribution and trends analysis</p>
                    </div>
                </div>

                <div class="user-panel">
                    <h3>📋 Quick Reports</h3>
                    <div class="action-buttons" style="flex-direction: column; gap: 0.5rem;">
                        <button class="btn btn-primary" onclick="generateDailyReport()">📅 Daily Report</button>
                        <button class="btn btn-success" onclick="generateCaseReport()">📄 Case Summary</button>
                        <button class="btn btn-warning" onclick="generateDetentionReport()">⛓️ Detention Report</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Suspect Details Modal for Users -->
    <div id="suspectDetailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0; color: #1e3c72;">👤 Suspect Details</h3>
                <button onclick="closeSuspectDetails()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">✕ Close</button>
            </div>

            <div id="suspectDetailsContent">
                <!-- Suspect details will be loaded here -->
            </div>

            <div style="margin-top: 1.5rem; text-align: center;">
                <button onclick="closeSuspectDetails()" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>

    <!-- NEW: Complaint Details Modal for Users -->
    <div id="complaintDetailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 10px; width: 90%; max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0; color: #1e3c72;">📋 Complaint Details</h3>
                <button onclick="closeComplaintDetails()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">✕ Close</button>
            </div>

            <div id="complaintDetailsContent">
                <!-- Complaint details will be loaded here -->
            </div>

            <div style="margin-top: 1.5rem; text-align: center;">
                <button onclick="closeComplaintDetails()" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>

    <script src="user-dashboard.js"></script>
</body>
</html>